(function(){var o=/\{([^\}]+)\}/g,p=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,q=function(f,h,k){var a=k;h.replace(p,function(f,c,e,d,g){c=c||d;a&&(c in a&&(a=a[c]),typeof a=="function"&&g&&(a=a()))});return a=(a==null||a==k?f:a)+""},r=function(f,h){return String(f).replace(o,function(f,a){return q(f,a,h)})};Raphael.fn.popup=function(f,h,k,a,n){a=String(a||"top-middle").split("-");a[1]=a[1]||"middle";var c=k.getBBox(),e=Math.round(c.width),d=Math.round(c.height),g=Math.round(c.x)- 5,c=Math.round(c.y)-5,b=Math.min(d/2,e/2,10),l=[{x:g+5,y:c,w:e,w4:e/4,h4:d/4,right:0,left:e-b*2,bottom:0,top:d-b*2,r:5,h:d,gap:b},{x:g+5,y:c,w:e,w4:e/4,h4:d/4,left:e/2-b,right:e/2-b,top:d/2-b,bottom:d/2-b,r:5,h:d,gap:b},{x:g+5,y:c,w:e,w4:e/4,h4:d/4,left:0,right:e-b*2,top:0,bottom:d-b*2,r:5,h:d,gap:b}][a[1]=="middle"?1:(a[1]=="top"||a[1]=="left")*2],i=0,j=0,m=this.path(r({top:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{gap},{gap}-{gap}-{gap}-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z", bottom:"M{x},{y}l{left},0,{gap}-{gap},{gap},{gap},{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",right:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom}-{gap}-{gap},{gap}-{gap},0-{top}a{r},{r},0,0,1,{r}-{r}z",left:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},{gap},{gap}-{gap},{gap},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z"}[a[0]], l)).insertBefore(k);switch(a[0]){case "top":i=f-(g+5+l.left+b);j=h-(c+5+d+5+b);break;case "bottom":i=f-(g+5+l.left+b);j=h-(c-b);break;case "left":i=f-(g+5+e+5+b);j=h-(c+5+l.top+b);break;case "right":i=f-(g-b),j=h-(c+5+l.top+b)}m.translate(i,j);if(n)return n=m.attr("path"),m.remove(),{path:n,dx:i,dy:j};k.translate(i,j);return m}})();