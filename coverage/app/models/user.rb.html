<html>
  <head>
    <title>app/models/user.rb</title>
    
    <link href="../../report.css?0.13756176795977781" media="screen" rel="stylesheet" type="text/css" />
    <script src='../../jquery.js?0.6820016633351912'></script>
    <script>
      $(function() {

        $('#toggle_test_file').click(function(e) {
          e.preventDefault();
          if ($('#main_file').hasClass('side_by_side')) {
            $('#main_file').removeClass('side_by_side');
          } else {
            $('#main_file').addClass('side_by_side');
          }
        
          $('#test_file').toggle();
        });

        $('#test_file').hide();
        
        function cleanString(str) {
          return $.trim(str.replace(/<[^(<|>)]+>/gi, ''));
        }
        
        $('.line_number').hover(function() {
          $(this).attr('title', 'Line: ' + cleanString($(this).html()));
        });
        
        $('.hit_number').hover(function() {
          $(this).attr('title', 'Execution Count: ' + cleanString($(this).html()));
        });
        
        $('.code_line').hover(function() {
          $(this).attr('title', cleanString($(this).html()));
        });
        
      });
    </script>
  </head>
  <body>
    <h1><a href="../../index.html">Coverage Report</a></h1>
    
    <table cellpadding='0' cellspacing='1'>
      <tr class='header'>
        <th>File</th>
        <th>Lines</th>
        <th>Lines Of Code</th>
        <th>Untested Lines of Code</th>
        <th>Tested %</th>
      </tr>
      <tr valign='top'>
        <td>
          app/models/user.rb
          
            <br />
            <a href='#' id='toggle_test_file'>spec/models/user_spec.rb</a>
          
        </td>
        <td>109</td>
        <td>60</td>
        <td>15</td>
        <td>75.0%</td>
      </tr>
    </table>

    <div>&nbsp;</div>
    
    <table cellpadding='0' cellspacing='1'>
      <tr>
        <th>Legend</th>
      </tr>
      <tr>
        <td class='hit'>This line was executed.</td>
      </tr>
      <tr>
        <td class='miss'>This line was not executed!</td>
      </tr>
      <tr>
        <td class='never'>This line doesn't matter.</td>
      </tr>
    </table>
    
    <div>&nbsp;</div>

    <div id='content'>
      <div id='main_file'>
        <table id='main'>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>1</td>
              <td class='code_line'>
                <pre>class User < ActiveRecord::Base</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>2</td>
              <td class='code_line'>
                <pre>  include CommonScopes</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>3</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>4</td>
              <td class='code_line'>
                <pre>  has_paper_trail</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>5</td>
              <td class='code_line'>
                <pre>  has_many :permissions</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>6</td>
              <td class='code_line'>
                <pre>  has_many :twitter_accounts</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>7</td>
              <td class='code_line'>
                <pre>  has_many :facebook_accounts</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>8</td>
              <td class='code_line'>
                <pre>  has_many :wordpress_accounts</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>9</td>
              <td class='code_line'>
                <pre>  has_many :adopt_a_pet_accounts</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>10</td>
              <td class='code_line'>
                <pre>  has_many :notes</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>11</td>
              <td class='code_line'>
                <pre>  has_many :roles, :through => :permissions</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>12</td>
              <td class='code_line'>
                <pre>  #has_and_belongs_to_many :organizations</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>13</td>
              <td class='code_line'>
                <pre>  belongs_to :organization</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>14</td>
              <td class='code_line'>
                <pre>  # Include default devise modules. Others available are:</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>15</td>
              <td class='code_line'>
                <pre>  # :token_authenticatable, :encryptable, :confirmable, :lockable, :timeoutable and :omniauthable</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>16</td>
              <td class='code_line'>
                <pre>  devise :database_authenticatable, :registerable,</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>17</td>
              <td class='code_line'>
                <pre>         :recoverable, :trackable, :validatable, :confirmable</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>18</td>
              <td class='code_line'>
                <pre> # Virtual attribute for authenticating by either username or email</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>19</td>
              <td class='code_line'>
                <pre> # This is in addition to a real persisted field like 'username'</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>20</td>
              <td class='code_line'>
                <pre> attr_accessor :login, :no_send_email, :skip_default_role</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>21</td>
              <td class='code_line'>
                <pre>         </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>22</td>
              <td class='code_line'>
                <pre>  # Setup accessible (or protected) attributes for your model</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>23</td>
              <td class='code_line'>
                <pre>  attr_accessible :email, :password, :password_confirmation, :remember_me, :username, :login, :organization_name, :owner,</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>24</td>
              <td class='code_line'>
                <pre>                   :no_send_email, :skip_default_role</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>25</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>26</td>
              <td class='code_line'>
                <pre>  before_create :add_to_organization</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>27</td>
              <td class='code_line'>
                <pre>  after_create :add_default_role, :send_new_email</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>28</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>29</td>
              <td class='code_line'>
                <pre>  validates_presence_of :username</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>30</td>
              <td class='code_line'>
                <pre>  validates_uniqueness_of :username</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>31</td>
              <td class='code_line'>
                <pre>  validates_presence_of :organization_name</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>32</td>
              <td class='code_line'>
                <pre>  validates_uniqueness_of :organization_name, :if => :should_validate_organization_name?</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>33</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>34</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>35</td>
              <td class='code_line'>
                <pre>  # show the user email in the admin UI instead of the user id</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>36</td>
              <td class='code_line'>
                <pre>  def show_username_label_method</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>37</td>
              <td class='code_line'>
                <pre>    "#{self.username}"</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>38</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>39</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>40</td>
              <td class='code_line'>
                <pre>  def role?(role)</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>41</td>
              <td class='code_line'>
                <pre>    #Rails.cache.fetch("role_for_user_#{self.id}_#{self.updated_at}") do</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>42</td>
              <td class='code_line'>
                <pre>      #self.roles.find_by_name(role.to_s.camelize)</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>43</td>
              <td class='code_line'>
                <pre>      return !!self.roles.find_by_name(role.to_s.camelize)</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>44</td>
              <td class='code_line'>
                <pre>      #return !!self.roles.find(:first, :select => 'roles.name, roles.id')</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>45</td>
              <td class='code_line'>
                <pre>      #Permission.find(:all, :joins => {:roles => :users}, :conditions => ["user.id = ?", self.id])</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>46</td>
              <td class='code_line'>
                <pre>      #self.roles.joins(:roles).where('roles.id', "%#{var}%")</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>47</td>
              <td class='code_line'>
                <pre>    #end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>48</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>49</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>50</td>
              <td class='code_line'>
                <pre>  def add_default_role</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>51</td>
              <td class='code_line'>
                <pre>    unless self.skip_default_role == true</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>52</td>
              <td class='code_line'>
                <pre>      if self.owner == 1</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>53</td>
              <td class='code_line'>
                <pre>        @user = self.id</pre>
              </td>
              <td class='hit_number'>14</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>54</td>
              <td class='code_line'>
                <pre>        @permission = Permission.new</pre>
              </td>
              <td class='hit_number'>14</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>55</td>
              <td class='code_line'>
                <pre>        #@permission.update_attributes(:user_id => @user, :role_id => 2)</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>56</td>
              <td class='code_line'>
                <pre>        @permission.user_id = @user</pre>
              </td>
              <td class='hit_number'>14</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>57</td>
              <td class='code_line'>
                <pre>        @permission.role_id = 2</pre>
              </td>
              <td class='hit_number'>14</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>58</td>
              <td class='code_line'>
                <pre>        @permission.save!</pre>
              </td>
              <td class='hit_number'>14</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>59</td>
              <td class='code_line'>
                <pre>      else</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>60</td>
              <td class='code_line'>
                <pre>        @user = self.id</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>61</td>
              <td class='code_line'>
                <pre>        @permission = Permission.new</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>62</td>
              <td class='code_line'>
                <pre>        #@permission.update_attributes(:user_id => @user, :role_id => 3)</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>63</td>
              <td class='code_line'>
                <pre>        @permission.user_id = @user</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>64</td>
              <td class='code_line'>
                <pre>        @permission.role_id = 3</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>65</td>
              <td class='code_line'>
                <pre>        @permission.save!</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>66</td>
              <td class='code_line'>
                <pre>      end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>67</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>68</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>69</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>70</td>
              <td class='code_line'>
                <pre>  def add_to_organization</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>71</td>
              <td class='code_line'>
                <pre>    if self.organization_id.nil?</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>72</td>
              <td class='code_line'>
                <pre>      @organization = Organization.new</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>73</td>
              <td class='code_line'>
                <pre>      @organization.name = self.organization_name</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>74</td>
              <td class='code_line'>
                <pre>      #@organization.update_attributes(:name => "#{self.organization_name}") </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>75</td>
              <td class='code_line'>
                <pre>      @organization.save!</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>76</td>
              <td class='code_line'>
                <pre>      self.organization_id = @organization.id</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>77</td>
              <td class='code_line'>
                <pre>    else</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>78</td>
              <td class='code_line'>
                <pre>      #do nothing</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>79</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>80</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>81</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>82</td>
              <td class='code_line'>
                <pre>  protected</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>83</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>84</td>
              <td class='code_line'>
                <pre>  def self.find_for_database_authentication(warden_conditions)</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>85</td>
              <td class='code_line'>
                <pre>    conditions = warden_conditions.dup</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>86</td>
              <td class='code_line'>
                <pre>    login = conditions.delete(:login)</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>87</td>
              <td class='code_line'>
                <pre>    where(conditions).where(["lower(username) = :value OR lower(email) = :value", { :value => login.downcase }]).first</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>88</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>89</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>90</td>
              <td class='code_line'>
                <pre>  def should_validate_organization_name?</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>91</td>
              <td class='code_line'>
                <pre>    if self.organization_id.nil?</pre>
              </td>
              <td class='hit_number'>22</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>92</td>
              <td class='code_line'>
                <pre>      true</pre>
              </td>
              <td class='hit_number'>2</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>93</td>
              <td class='code_line'>
                <pre>    else</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>94</td>
              <td class='code_line'>
                <pre>      false</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>95</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>96</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>97</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>98</td>
              <td class='code_line'>
                <pre>  def send_new_email</pre>
              </td>
              <td class='hit_number'>1</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>99</td>
              <td class='code_line'>
                <pre>    unless Rails.env == "test" or self.no_send_email == true</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>100</td>
              <td class='code_line'>
                <pre>      url = "http://sendgrid.com/api/mail.send.json?api_user=#{ENV['SENDGRID_USERNAME']}&api_key=#{ENV['SENDGRID_PASSWORD']}&to=contact@travisberry.com&subject=Hospitium%20-%20New%20User&text=#{URI::encode(self.username)}%20created%20an%20account.%20#{URI::encode(self.email)}%20in%20organization%20#{URI::encode(self.organization.name)}&from=contact@hospitium.co"</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>101</td>
              <td class='code_line'>
                <pre>      resp = Net::HTTP.get_response(URI.parse(url))</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>102</td>
              <td class='code_line'>
                <pre>      data = resp.body</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>103</td>
              <td class='code_line'>
                <pre>      result = JSON.parse(data)</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>104</td>
              <td class='code_line'>
                <pre>      if result.has_key? 'Error'</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>105</td>
              <td class='code_line'>
                <pre>         raise "web service error"</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>106</td>
              <td class='code_line'>
                <pre>      end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>107</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>108</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>109</td>
              <td class='code_line'>
                <pre>end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
        </table>
      </div>
      
        <div id='test_file' class='side_by_side'>
          <table id='test'>
            
            
              <tr class="never">
                <td class='line_number'>1</td>
                <td class='code_line'>
                  <pre>require 'spec_helper'</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>2</td>
                <td class='code_line'>
                  <pre></pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>3</td>
                <td class='code_line'>
                  <pre>describe User do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>4</td>
                <td class='code_line'>
                  <pre>  before(:each) do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>5</td>
                <td class='code_line'>
                  <pre>    @attr = { </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>6</td>
                <td class='code_line'>
                  <pre></pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>7</td>
                <td class='code_line'>
                  <pre>    }</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>8</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>9</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>10</td>
                <td class='code_line'>
                  <pre>  describe "relations" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>11</td>
                <td class='code_line'>
                  <pre>    it{should belong_to(:organization)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>12</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>13</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:permissions)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>14</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:twitter_accounts)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>15</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:facebook_accounts)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>16</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:wordpress_accounts)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>17</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:adopt_a_pet_accounts)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>18</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:notes)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>19</td>
                <td class='code_line'>
                  <pre>    it{should have_many(:roles)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>20</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>21</td>
                <td class='code_line'>
                  <pre></pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>22</td>
                <td class='code_line'>
                  <pre>  describe "validations" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>23</td>
                <td class='code_line'>
                  <pre>    it{should validate_presence_of(:username)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>24</td>
                <td class='code_line'>
                  <pre>    it{should validate_presence_of(:organization_name)}</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>25</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>26</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>27</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>28</td>
                <td class='code_line'>
                  <pre>  describe "#add_default_role owner" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>29</td>
                <td class='code_line'>
                  <pre>    let(:user) { FactoryGirl.create(:user) }</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>30</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>31</td>
                <td class='code_line'>
                  <pre>    it "should create default role for the org owner" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>32</td>
                <td class='code_line'>
                  <pre>      user.permissions.first.role_id.should eql(2)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>33</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>34</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>35</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>36</td>
                <td class='code_line'>
                  <pre>  describe "#add_default_role user" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>37</td>
                <td class='code_line'>
                  <pre>    let(:user) { FactoryGirl.create(:user, @attr.merge(:owner => 0)) }</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>38</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>39</td>
                <td class='code_line'>
                  <pre>    it "should create default role for the org user" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>40</td>
                <td class='code_line'>
                  <pre>      user.permissions.first.role_id.should eql(3)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>41</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>42</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>43</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>44</td>
                <td class='code_line'>
                  <pre>  describe "#add_to_organization" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>45</td>
                <td class='code_line'>
                  <pre>    let(:user) { FactoryGirl.create(:user) }</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>46</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>47</td>
                <td class='code_line'>
                  <pre>    it "should add user to an organization" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>48</td>
                <td class='code_line'>
                  <pre>      user.organization_id.should_not be_nil</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>49</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>50</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>51</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>52</td>
                <td class='code_line'>
                  <pre>  describe 'protected attributes' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>53</td>
                <td class='code_line'>
                  <pre>    let(:user) { FactoryGirl.create(:user) }</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>54</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>55</td>
                <td class='code_line'>
                  <pre>    it 'should deny mass-assignment to the organization_id' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>56</td>
                <td class='code_line'>
                  <pre>      user.update_attributes(:organization_id =>  10000)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>57</td>
                <td class='code_line'>
                  <pre>      user.organization_id.should_not == 10000</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>58</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>59</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>60</td>
                <td class='code_line'>
                  <pre>    it 'should deny mass-assignment to the id' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>61</td>
                <td class='code_line'>
                  <pre>      user.update_attributes(:id =>  100000)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>62</td>
                <td class='code_line'>
                  <pre>      user.id.should_not == 100000</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>63</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>64</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>65</td>
                <td class='code_line'>
                  <pre>    it 'should deny mass-assignment to the encrypted password' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>66</td>
                <td class='code_line'>
                  <pre>      user.update_attributes(:encrypted_password =>  "test")</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>67</td>
                <td class='code_line'>
                  <pre>      user.encrypted_password.should_not == "test"</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>68</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>69</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>70</td>
                <td class='code_line'>
                  <pre>    it 'should deny mass-assignment to the reset_password_token' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>71</td>
                <td class='code_line'>
                  <pre>      user.update_attributes(:reset_password_token =>  "test")</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>72</td>
                <td class='code_line'>
                  <pre>      user.reset_password_token.should_not == "test"</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>73</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>74</td>
                <td class='code_line'>
                  <pre>    </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>75</td>
                <td class='code_line'>
                  <pre>    it 'should deny mass-assignment to the confirmation_token' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>76</td>
                <td class='code_line'>
                  <pre>      user.update_attributes(:confirmation_token =>  "test")</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>77</td>
                <td class='code_line'>
                  <pre>      user.confirmation_token.should_not == "test"</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>78</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>79</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>80</td>
                <td class='code_line'>
                  <pre></pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>81</td>
                <td class='code_line'>
                  <pre>  describe 'permissions and roles' do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>82</td>
                <td class='code_line'>
                  <pre>    it "should have 2 hives" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>83</td>
                <td class='code_line'>
                  <pre>      @user = FactoryGirl.create(:user)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>84</td>
                <td class='code_line'>
                  <pre>      @user.roles << FactoryGirl.create(:role)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>85</td>
                <td class='code_line'>
                  <pre>      assert_equal 1, @user.roles.length</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>86</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>87</td>
                <td class='code_line'>
                  <pre></pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>88</td>
                <td class='code_line'>
                  <pre>    it "should have 2 bees" do</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>89</td>
                <td class='code_line'>
                  <pre>      @user = FactoryGirl.create(:user)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>90</td>
                <td class='code_line'>
                  <pre>      @permission = FactoryGirl.create(:permission)</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>91</td>
                <td class='code_line'>
                  <pre>      #puts @permission</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>92</td>
                <td class='code_line'>
                  <pre>      assert_equal 1, @user.permissions.length</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>93</td>
                <td class='code_line'>
                  <pre>    end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>94</td>
                <td class='code_line'>
                  <pre>  end</pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>95</td>
                <td class='code_line'>
                  <pre></pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>96</td>
                <td class='code_line'>
                  <pre>  </pre>
                </td>
              </tr>
              
            
              <tr class="never">
                <td class='line_number'>97</td>
                <td class='code_line'>
                  <pre>end</pre>
                </td>
              </tr>
              
            
          </table>
        </div>
      
    </div>
    
    <p>Generated on: 07-01-2012 19:46</p>
  </body>
</html>