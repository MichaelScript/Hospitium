(function(b){b.widget("ra.remoteForm",{dialog:null,options:{dialogClass:"",height:600,width:720},_create:function(){var a=this,c=b(this.element).siblings("select").data("edit-url");typeof c!="undefined"&&c.length&&b("#"+this.element.parent().attr("id")+" .input.ra-multiselect option").live("dblclick",function(d){d.preventDefault();var e=a._getDialog();b.ajax({url:c.replace("__ID__",this.value),beforeSend:function(a){a.setRequestHeader("Accept","text/javascript")},success:function(b){e.html(b);a._bindFormEvents()}, error:function(a){e.html(a.responseText)},dataType:"text"})});b(a.element).bind("click",function(d){d.preventDefault();var e=a._getDialog();b.ajax({url:b(this).attr("href"),beforeSend:function(a){a.setRequestHeader("Accept","text/javascript")},success:function(b){e.html(b);a._bindFormEvents()},error:function(a){e.html(a.responseText)},dataType:"text"})})},_bindFormEvents:function(){var a=this._getDialog(),c=a.find("form"),d=this,e=a.find(":submit[name=_save]").text(),j=a.find(":submit[name=_continue]").text(); a.find("div.control").hide();a.dialog("option","title",b("h2.title",a).remove().text());c.attr("data-remote",true);a.find(":submit").remove();a.find(".ra-block-content").removeClass("ra-block-content");var g={};e&&(g[e]=function(){if(typeof CKEDITOR!="undefined")for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();a.find("form").submit()});j&&(g[j]=function(){a.dialog("close")});a.dialog("option","buttons",g);0==b("form > .navform :submit",a).length&&b("form > .navform", a).remove();c.bind("ajax:success",function(e,c){var f=b.parseJSON(c),h=d.element.siblings("select"),i=d.element.siblings(".ra-filtering-select-input"),g='<option value="'+f.id+'" selected>'+f.label+"</option>";if(d.element.siblings("button").length){if(i.length>0)i[0].value=f.label;if(h.length>0)h.html(g),h[0].value=f.id}else i=d.element.siblings(".input.ra-multiselect"),h.find("option[value="+f.id+"]").length?(h.find("option[value="+f.id+"]").text(f.label),i.find("option[value= "+f.id+"]").text(f.label)): (h.prepend(g),i.find("select.ra-multiselect-selection").prepend(g));a.dialog("close")});c.bind("ajax:error",function(b,c){a.html(c.responseText);d._bindFormEvents()})},_getDialog:function(){if(!this.dialog){var a=this;this.dialog=b('<div class="'+this.options.dialogClass+'"></div>').dialog({autoShow:false,close:function(){b(this).dialog("destroy");b(this).remove();a.dialog=null},modal:true,width:this.options.width,height:this.options.height})}return this.dialog}})})(jQuery);